{# templates/user/params.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Paramètres du compte{% endblock %}

{% block body %}
<main class="min-h-screen bg-[#1e293b] px-4 py-10">
  <div class="max-w-4xl mx-auto space-y-8">

    <h1 class="text-3xl font-bold text-white text-center">Paramètres du compte</h1>

    {# Flash messages #}
    {% for type, messages in app.flashes %}
      {% for message in messages %}
        <div class="rounded-md px-4 py-3 text-sm
                    {% if type == 'success' %}bg-green-100 text-green-800{% elseif type == 'error' %}bg-red-100 text-red-800{% else %}bg-gray-100 text-gray-800{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    {% endfor %}

    {# ——— Carte : Mes informations (lecture seule) ——— #}
    <section class="bg-white rounded-lg shadow p-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Mes informations</h2>

      <dl class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-gray-800">
        <div>
          <dt class="text-sm text-gray-500">Prénom</dt>
          <dd class="text-base font-medium">{{ app.user.firstname }}</dd>
        </div>

        <div>
          <dt class="text-sm text-gray-500">Nom</dt>
          <dd class="text-base font-medium">{{ app.user.lastname ?? '—' }}</dd>
        </div>

        <div class="sm:col-span-2">
          <dt class="text-sm text-gray-500">Email</dt>
          <dd class="text-base font-medium break-all">{{ app.user.email }}</dd>
        </div>

        <div>
          <dt class="text-sm text-gray-500">Création du compte</dt>
          <dd class="text-base font-medium">
            {{ app.user.createdAt ? app.user.createdAt|date('d/m/Y H:i') : '—' }}
          </dd>
        </div>

        <div>
          <dt class="text-sm text-gray-500">Statut de vérification</dt>
          <dd class="text-base font-medium">
            {% if app.user.isVerified %}
              <span class="inline-block px-2 py-1 bg-green-100 text-green-800 rounded">Vérifié</span>
            {% else %}
              <span class="inline-block px-2 py-1 bg-yellow-100 text-yellow-800 rounded">Non vérifié</span>
            {% endif %}
          </dd>
        </div>
      </dl>

      {# ——— Sous-bloc : Coordonnées (lecture) avec condition ——— #}
      <div class="mt-6 pt-4 border-t border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900 mb-3">Mes coordonnées</h3>

        {% set has_all_contact =
          app.user.billingAddress
          and app.user.billingCity
          and app.user.billingZipCode
          and app.user.phoneNumber
        %}

        {% if has_all_contact %}
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-gray-800">
            <p><span class="text-sm text-gray-500">Adresse :</span>
              <span class="block font-medium">{{ app.user.billingAddress }}</span>
            </p>
            <p><span class="text-sm text-gray-500">Ville :</span>
              <span class="block font-medium">{{ app.user.billingCity }}</span>
            </p>
            <p><span class="text-sm text-gray-500">Code postal :</span>
              <span class="block font-medium">{{ app.user.billingZipCode }}</span>
            </p>
            <p><span class="text-sm text-gray-500">Téléphone :</span>
              <span class="block font-medium">{{ app.user.phoneNumber }}</span>
            </p>
          </div>
        {% else %}
          <div class="rounded-md bg-yellow-50 border border-yellow-200 p-4 text-yellow-800">
            Pour compléter votre profil et faciliter les démarches (inscriptions, facturation, contact),
            il est <strong>conseillé de renseigner</strong> votre adresse, votre ville, votre code postal
            et votre numéro de téléphone.
          </div>
        {% endif %}
      </div>

      <div class="mt-6 pt-4 border-t border-gray-200 flex justify-end">
        <a href="{{ path('app_user_profile_settings_password') }}"
           class="inline-flex items-center justify-center bg-[#1640f9] hover:bg-[#001556] text-white font-semibold px-5 py-2 rounded transition">
          Modifier mon mot de passe
        </a>
      </div>
    </section>

    {# ——— Carte : Formulaire de mise à jour coordonnées ——— #}
    <section class="bg-white rounded-lg shadow p-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Mettre à jour mes coordonnées</h2>

      {{ form_start(resetProfil, { attr: { class: 'space-y-5' } }) }}
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div class="sm:col-span-2">
            {{ form_row(resetProfil.billing_address, {
              label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' },
              attr: {
                class: 'w-full px-4 py-3 rounded-md bg-white text-gray-900 placeholder-gray-500 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#f97316] focus:border-[#f97316]'
              }
            }) }}
          </div>

          <div>
            {{ form_row(resetProfil.billing_city, {
              label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' },
              attr: {
                class: 'w-full px-4 py-3 rounded-md bg-white text-gray-900 placeholder-gray-500 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#f97316] focus:border-[#f97316]'
              }
            }) }}
          </div>

          <div>
            {{ form_row(resetProfil.billing_zip_code, {
              label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' },
              attr:{
                class: 'w-full px-4 py-3 rounded-md bg-white text-gray-900 placeholder-gray-500 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#f97316] focus:border-[#f97316]'
              }
            }) }}
          </div>

          <div class="sm:col-span-2">
            {{ form_row(resetProfil.phoneNumber, {
              label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' },
              attr: {
                class: 'w-full px-4 py-3 rounded-md bg-white text-gray-900 placeholder-gray-500 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#f97316] focus:border-[#f97316]'
              }
            }) }}
          </div>
        </div>

        <div class="pt-2">
          <button type="submit"
                  class="w-full sm:w-auto px-5 py-3 rounded-md bg-[#f97316] text-white font-semibold hover:bg-[#ea580c] transition">
            Enregistrer les modifications
          </button>
        </div>
      {{ form_end(resetProfil) }}
    </section>

  </div>
</main>
{% endblock %}
